docker compose up -d

docker container exec -it docker-compose-trino-coordinator-1 trino

docker exec -it "docker-compose-postgres-1" psql -U admin -d "hive_db"

-- create bucket 'hive'
-- create directory 'datasets' and upload the file

CREATE SCHEMA hive.hp
WITH (location = 's3a://hive/');


CREATE TABLE hive.hp.nyc_taxi_zone_hive (
    location_id VARCHAR,
    borough VARCHAR,
    zone VARCHAR,
    service_zone VARCHAR
)
WITH (
    external_location = 's3a://hive/datasets/',
    format = 'CSV',
    skip_header_line_count = 1
);

select count(*) from hive.hp.nyc_taxi_zone_hive;

select * from hive.hp.nyc_taxi_zone_hive limit 10;

-- create bucket 'iceberg'
-- create directory 'taxi_zone_lookup'

CREATE SCHEMA iceberg.ip
WITH (location = 's3a://iceberg/');


CREATE TABLE iceberg.ip.nyc_taxi_zone_ice (
    location_id VARCHAR,
    borough VARCHAR,
    zone VARCHAR,
    service_zone VARCHAR
)
WITH (
    location = 's3a://iceberg/taxi_zone_lookup',  
    format = 'PARQUET'
);


insert into iceberg.ip.nyc_taxi_zone_ice
select * from hive.hp.nyc_taxi_zone_hive;

select count(*) from iceberg.ip.nyc_taxi_zone_ice;

select * from iceberg.ip.nyc_taxi_zone_ice limit 10;


show tables in iceberg.ip;

show tables in hive.hp;

SELECT
 "DB_ID",
 "DB_LOCATION_URI",
 "NAME", 
 "OWNER_NAME",
 "OWNER_TYPE",
 "CTLG_NAME"
FROM "DBS";


docker compose down  

docker compose down -v 

docker volume prune -f

